#!/usr/bin/env bash

if [ "$#" -eq 0 ]; then
	>&2 echo "Usage: $0 [â€¦project_type] directory"
	exit 1
fi

#--determine src dir
#-@ https://stackoverflow.com/a/246128
scriptPath=${BASH_SOURCE[0]}
while [ -L "$scriptPath" ]; do
	scriptDir=$(cd -P "$(dirname "$scriptPath")" >/dev/null 2>&1 && pwd)
	scriptPath=$(readlink "$scriptPath")
	[[ $scriptPath != /* ]] && scriptPath=$scriptDir/$scriptPath
done
srcDir=$(cd -P "$(dirname "$scriptPath")" >/dev/null 2>&1 && pwd)"/../src/"

#--make project dir, move into it
mkdir -p "${@: -1}"
cd "${@: -1}"

#--copy type files into place
tmpDir=_tmp$(date "+%Y%m%d-%H%M%S")
rsync -Dglopr "${srcDir}/base/" $tmpDir
for (( i=1; i <= $# - 1; ++i )); do
	src="${srcDir}${!i}/"
	if [[ -d $src ]]; then
		rsync -Dglopr $src $tmpDir
	else
		>&2 echo "project type \"${!i}\" not found"
	fi
done
shopt -s dotglob
mv -i $tmpDir/* .
rm -r $tmpDir
